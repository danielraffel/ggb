name: test-ssh-restart

on:
  workflow_dispatch:

jobs:
  restart:
    runs-on: ubuntu-latest
    steps:
      - name: Create SSH key file
        run: |
          echo "$SSH_KEY" > key.pem
          chmod 600 key.pem
        env:
          SSH_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Run remote restart script and confirm
        run: |
          ssh -i key.pem -o StrictHostKeyChecking=no ${{ secrets.SSH_USERNAME }}@${{ secrets.SSH_HOST }} \
          '/home/${{ secrets.SSH_USERNAME }}/restart.sh && echo "âœ… restart.sh executed successfully" && tail -n 10 /home/${{ secrets.SSH_USERNAME }}/restart.log'
