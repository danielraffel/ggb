<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Golden Gate Bridge Weather</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <style>
        @media (min-width: 768px) {
            .title-desktop {
                display: block;
            }
            .title-mobile {
                display: none;
            }
        }
        @media (max-width: 767px) {
            .title-desktop {
                display: none;
            }
            .title-mobile {
                display: none;  // Changed to hide the mobile title
            }
            h2#future-conditions-title {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="title-desktop text-3xl font-bold mb-6 text-center">Golden Gate Bridge Live</h1>
        
        <div class="mb-8">
            <iframe class="w-full aspect-video" scrolling="no" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen allow="autoplay; fullscreen" src="https://w3.mp.lura.live/player/prod/v3/anvload.html?key=eyJtIjoiTElOIiwidiI6ImFkc3Qxa1dabWtFZ1hLeDciLCJhbnZhY2siOiJFWm1yUjRFdjV4WW5NZmRiWTVUUGM3bmFLbXkzMk1LcCIsInNoYXJlTGluayI6Imh0dHBzOi8vd3d3Lmtyb240LmNvbS9saXZlLWV2ZW50cy8iLCJwbHVnaW5zIjp7ImNvbXNjb3JlIjp7ImNsaWVudElkIjoiNjAzNjQzOSIsImMzIjoia3JvbjQuY29tIiwic2NyaXB0IjoiLy93My5tcC5sdXJhLmxpdmUvcGxheWVyL3Byb2QvdjMvcGx1Z2lucy9jb21zY29yZS9jb21zY29yZXBsdWdpbi5taW4uanMiLCJ1c2VEZXJpdmVkTWV0YWRhdGEiOnRydWUsIm1hcHBpbmciOnsiYWRsb2FkdHlwZSI6MiwiYWRNb2RlbCI6Mn0sIm9wdE91dCI6ZmFsc2V9LCJzZWdtZW50Q3VzdG9tIjp7InNjcmlwdCI6Imh0dHBzOi8vc2VnbWVudC5wc2cubmV4c3RhcmRpZ2l0YWwubmV0L2FudmF0by5qcyIsIndyaXRlS2V5IjoiUUdOcU9tbVlwaXIwZjVEWGtad2daYThsMnh2YVNJakoiLCJwbHVnaW5zTG9hZGluZ1RpbWVvdXQiOjEyfX0sImh0bWw1Ijp0cnVlLCJ0b2tlbiI6ImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSklVekkxTmlKOS5leUoyYVdRaU9pSmhaSE4wTVd0WFdtMXJSV2RZUzNnM0lpd2lhWE56SWpvaVJWcHRjbEkwUlhZMWVGbHVUV1prWWxrMVZGQmpOMjVoUzIxNU16Sk5TM0FpTENKbGVIQWlPakUyTkRVd05EUXhNamw5LlJBSm1ZbHZSdThueEtKZWwtcUozR3FocjRZcENhcU1qWF9lenZib1FCV0UifQ%3D%3D"></iframe>
        </div>

        <h1 class="title-mobile text-xl font-bold mb-6 text-center">Golden Gate Bridge Live</h1>

        <div id="weather" class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 id="current-weather-title" class="text-2xl font-semibold mb-4">Current Weather</h2>
            <div id="weather-info" class="text-lg"></div>
            <div id="sunset-info" class="text-lg mt-2"></div>
        </div>

        <div id="future-conditions" class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-2xl font-semibold mb-4 hidden md:block">Future Conditions</h2>
            <div class="mb-4 flex items-center">
                <label for="time-input" class="font-semibold flex items-center text-2xl md:text-base">Weather at: <span class="mr-2"></span></label>
                <input type="time" id="time-input" name="time" class="border rounded px-2 py-1">
                <span id="time-difference" class="ml-2 text-lg"></span> <!-- Added span for time difference -->
            </div>
            <div id="future-weather-info" class="text-lg"></div>
        </div>
    </div>

    <script>
        const weatherInfo = document.getElementById('weather-info');
        const sunsetInfo = document.getElementById('sunset-info');
        const futureWeatherInfo = document.getElementById('future-weather-info');
        const timeInput = document.getElementById('time-input');
    
        function getDefaultTimeDiff() {
            const storedDiff = localStorage.getItem('defaultTimeDiff');
            return storedDiff ? parseInt(storedDiff, 10) : 2 * 60; // Default to 2 hours (120 minutes)
        }
    
        function setDefaultTimeDiff(diff) {
            localStorage.setItem('defaultTimeDiff', diff.toString());
        }
    
        function setTimeInputFromStoredDiff() {
            const defaultDiff = getDefaultTimeDiff();
            const now = new Date();
            const futureTime = new Date(now.getTime() + defaultDiff * 60000);
            timeInput.value = futureTime.toTimeString().slice(0, 5);
        }
    
        async function getWeather() {
            try {
                const response = await axios.get('https://api.open-meteo.com/v1/forecast?latitude=37.8199&longitude=-122.4783&current_weather=true&temperature_unit=fahrenheit&hourly=temperature_2m,precipitation_probability,windspeed_10m&daily=sunset&timezone=America/Los_Angeles');
                const data = response.data;
                const weather = data.current_weather;
                const currentHour = new Date().getHours();
                const precipitationProbability = data.hourly.precipitation_probability[currentHour];
    
                const isLikelyToRain = precipitationProbability > 30 ? 'Yes' : 'No';
    
                weatherInfo.innerHTML = `
                    <p>Temperature: ${weather.temperature}°F</p>
                    <p>Wind Speed: ${weather.windspeed} mph</p>
                    <p>Likely to Rain: ${isLikelyToRain} (${precipitationProbability}% chance)</p>
                `;
    
                const sunsetTime = new Date(data.daily.sunset[0]);
                sunsetInfo.innerHTML = `<p>Sunset today: ${sunsetTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</p>`;
    
                setTimeInputFromStoredDiff();
                updateForecast();
            } catch (error) {
                console.error('Error fetching weather data:', error);
                weatherInfo.innerHTML = '<p>Unable to fetch weather data. Please try again later.</p>';
            }
        }
    
        async function getFutureWeather(time) {
            try {
                const response = await axios.get('https://api.open-meteo.com/v1/forecast?latitude=37.8199&longitude=-122.4783&hourly=temperature_2m,precipitation_probability,windspeed_10m&temperature_unit=fahrenheit&timezone=America/Los_Angeles');
                const data = response.data;
                
                const [hours, minutes] = time.split(':').map(Number);
                const futureTime = new Date();
                futureTime.setHours(hours, minutes, 0, 0);
    
                const index = data.hourly.time.findIndex(t => new Date(t).getTime() > futureTime.getTime()) - 1;
    
                const temperature = data.hourly.temperature_2m[index];
                const windSpeed = data.hourly.windspeed_10m[index];
                const precipitationProbability = data.hourly.precipitation_probability[index];
    
                const isLikelyToRain = precipitationProbability > 30 ? 'Yes' : 'No';
    
                futureWeatherInfo.innerHTML = `
                    <p>Temperature: ${temperature}°F</p>
                    <p>Wind Speed: ${windSpeed} mph</p>
                    <p>Likely to Rain: ${isLikelyToRain} (${precipitationProbability}% chance)</p>
                `;
            } catch (error) {
                console.error('Error fetching future weather data:', error);
                futureWeatherInfo.innerHTML = '<p>Unable to fetch future weather data. Please try again later.</p>';
            }
        }
        
        function updateForecast() {
            const time = timeInput.value;
            getFutureWeather(time);

            // Calculate the new time difference, handling AM/PM transitions
            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            let selectedTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);

            // If the selected time is earlier than now, it must be for tomorrow
            if (selectedTime < now) {
                selectedTime.setDate(selectedTime.getDate() + 1);
            }

            const diffInMinutes = Math.round((selectedTime - now) / 60000);
            
            if (diffInMinutes > 0) {
                setDefaultTimeDiff(diffInMinutes);
            }

            // Update the time difference display
            updateTimeDifferenceDisplay(diffInMinutes);

            console.log(`Time difference set to ${diffInMinutes} minutes`);
        }

        function updateTimeDifferenceDisplay(diffInMinutes) {
            // Check if the difference is less than 1 minute
            if (diffInMinutes < 1) {
                document.getElementById('time-difference').innerText = 'in 0 minutes';
                return;
            }

            const hours = Math.floor(diffInMinutes / 60);
            const minutes = diffInMinutes % 60;
            let timeDiffString = '';

            if (hours > 0) {
                timeDiffString += `${hours} hour${hours > 1 ? 's' : ''}`;
            }
            if (minutes > 0) {
                timeDiffString += (timeDiffString ? ' ' : '') + `${minutes} minute${minutes > 1 ? 's' : ''}`;
            }

            document.getElementById('time-difference').innerText = `in ${timeDiffString}`;
        }

        function updateCurrentWeatherTitle() {
            const isMobile = window.innerWidth < 768;
            const currentWeatherTitle = document.getElementById('current-weather-title');
            if (isMobile) {
                currentWeatherTitle.innerHTML = 'Current Weather @ GGB';
            } else {
                currentWeatherTitle.innerHTML = 'Current Weather';
            }
        }
    
        getWeather();
        updateCurrentWeatherTitle();
        setInterval(() => {
            getWeather();
            updateCurrentWeatherTitle();
        }, 600000);
    
        timeInput.addEventListener('change', updateForecast);
    </script>
</body>
</html>
